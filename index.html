<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Relat√≥rio de Atividades - Instrumenta√ß√£o</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
  * { box-sizing:border-box; margin:0; padding:0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; scroll-behavior:smooth; }
  html, body { height:100%; background:#f4f5f7; }

  header {
    background:linear-gradient(135deg,#6a11cb,#2575fc);
    color:#fff; padding:1rem 2rem; display:flex; align-items:center; justify-content:space-between;
    font-size:1.5rem; position:sticky; top:0; z-index:100; box-shadow:0 4px 15px rgba(0,0,0,0.25);
    border-bottom-left-radius:16px; border-bottom-right-radius:16px;
  }
  header img { height:50px; border-radius:12px; background:#fff; padding:4px; }

  .container {
    flex:1; overflow-y:auto; padding:2rem; display:flex; flex-direction:column; gap:2rem;
  }

  .atividade {
    background:#fff;
    border-radius:20px;
    box-shadow:0 10px 25px rgba(0,0,0,0.08);
    padding:2rem;
    transition: transform 0.3s, box-shadow 0.3s, filter 0.3s;
    opacity:0; transform:translateY(20px); animation:fadeIn 0.5s forwards;
  }

  @keyframes fadeIn { to { opacity:1; transform:translateY(0); } }

  .atividade:hover { transform: translateY(-5px); box-shadow:0 20px 40px rgba(0,0,0,0.15); filter:brightness(1.03); }

  .atividade label { font-weight:600; margin-bottom:0.5rem; display:block; text-transform:uppercase; color:#4b3f72; }

  .atividade input, .atividade textarea, .atividade select {
    width:100%; padding:1rem; margin-bottom:1rem; border-radius:16px; border:1px solid #d1d5db;
    background:#f9fafc; font-size:1rem; transition: all 0.3s; text-transform:uppercase; outline:none;
  }
  .atividade input:focus, .atividade textarea:focus, .atividade select:focus {
    border:2px solid #6a11cb; box-shadow:0 0 12px rgba(106,17,203,0.2); background:#fff;
  }
  .atividade textarea { min-height:100px; resize:vertical; }

  .outro-instrumento { display:none; }

  .btn-group { display:flex; gap:12px; flex-wrap:wrap; margin-top:0.5rem; }
  .btn-remover, .btn-duplicar {
    flex:1; padding:1rem; border:none; border-radius:16px; cursor:pointer; font-weight:600; transition: all 0.3s;
    color:#fff; background:linear-gradient(135deg,#6a11cb,#2575fc); box-shadow:0 6px 15px rgba(0,0,0,0.15);
  }
  .btn-remover:hover, .btn-duplicar:hover { transform:translateY(-3px); filter:brightness(1.1); }

  .btn-fab {
    position:fixed; bottom:90px; right:20px; background:linear-gradient(135deg,#f7971e,#ffd200);
    color:#fff; border:none; border-radius:50%; width:65px; height:65px; font-size:2rem; cursor:pointer;
    box-shadow:0 8px 25px rgba(0,0,0,0.25); transition: all 0.3s; z-index:200;
  }
  .btn-fab:hover { transform:scale(1.1); }

  .btn-whatsapp {
    position:fixed; bottom:20px; left:20px; background:#25D366;
    color:#fff; border:none; border-radius:50%; width:65px; height:65px; font-size:2rem; cursor:pointer;
    display:flex; align-items:center; justify-content:center;
    box-shadow:0 8px 25px rgba(0,0,0,0.25); transition: all 0.3s; z-index:200;
  }
  .btn-whatsapp:hover { transform:scale(1.1); }

  footer {
    background:#fff; padding:1rem 1.5rem; display:flex; justify-content:space-between;
    border-top:1px solid #ddd; position:sticky; bottom:0; gap:1rem;
  }
  footer button {
    flex:1; padding:1rem; font-size:1rem; border:none; border-radius:16px; cursor:pointer; font-weight:600; color:#fff;
    transition:all 0.3s; box-shadow:0 6px 15px rgba(0,0,0,0.15);
  }
  .btn-pdf { background:linear-gradient(135deg,#6a11cb,#2575fc); }
  .btn-pdf:hover { transform:translateY(-3px); filter:brightness(1.1); }

  @media (max-width:600px){
    header{font-size:1.2rem; padding:1rem;}
    .atividade input, .atividade textarea, .atividade select{font-size:0.95rem;}
    footer button{font-size:0.9rem; padding:0.8rem;}
  }
</style>
</head>
<body>
<header>
  üìã Instrumenta√ß√£o GME - M. Dias Branco
  <img src="https://media-genial-analisa.genialinvestimentos.com.br/wp-content/uploads/2021/12/22171726/m-dias-branco-logo-azul.png" alt="Logo M. Dias Branco">
</header>

<div class="container">
  <div class="atividade" id="tecnico-responsavel">
    <label><b>T√âCNICO INSTRUMENTISTA RESPONS√ÅVEL:</b></label>
    <select id="select-tecnico" required>
      <option value="">SELECIONE O T√âCNICO</option>
      <option>D√ÅRIO / MORAES</option>
      <option>OUTRO</option>
    </select>
  </div>
  <div id="atividades"></div>
</div>

<button class="btn-fab" onclick="adicionarAtividade()">+</button>
<button class="btn-whatsapp" onclick="compartilharWhatsApp()">üì±</button>

<template id="template-atividade">
  <div class="atividade">
    <label>üî¢ N¬∫ DA ORDEM/NOTA:</label>
    <input type="number" placeholder="Ex: 40803175" required>

    <label>üîß TIPO DE INSTRUMENTO:</label>
    <select class="tipo-instrumento" required>
      <option value="">SELECIONE</option>
      <option>TRANSMISSOR DE TEMPERATURA</option>
      <option>TRANSMISSOR DE PRESS√ÉO</option>
      <option>TRANSMISSOR DE N√çVEL</option>
      <option>TRANSMISSOR DE VAZ√ÉO</option>
      <option>V√ÅLVULA DE CONTROLE</option>
      <option>V√ÅLVULA REDUTORA</option>
      <option>TANQUE BALAN√áA</option>
      <option>BALAN√áA DE BANCADA</option>
      <option>MAN√îMETRO</option>
      <option>TERM√îMETRO</option>
      <option>ELETRODO PHMETRO</option>
      <option>CONDUTIV√çMETRO</option>
      <option>CHAVE DE N√çVEL</option>
      <option value="OUTRO">OUTRO</option>
    </select>
    <input type="text" class="outro-instrumento" placeholder="Digite o instrumento" />

    <label>üìù DESCRI√á√ÉO DA ATIVIDADE:</label>
    <textarea placeholder="Descri√ß√£o detalhada da atividade" required></textarea>

    <label>‚öôÔ∏è ATIVIDADES REALIZADAS:</label>
    <textarea placeholder="Liste as atividades realizadas" required></textarea>

    <label>üìç STATUS FINAL:</label>
    <select>
      <option>SELECIONE</option>
      <option>CONCLU√çDO</option>
      <option>N√ÉO CONCLU√çDO</option>
      <option>EM ANDAMENTO</option>
    </select>

    <div class="btn-group">
      <button class="btn-remover" onclick="removerAtividade(this)">REMOVER</button>
      <button class="btn-duplicar" onclick="duplicarAtividade(this)">DUPLICAR</button>
    </div>
  </div>
</template>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const atividadesDiv = document.getElementById("atividades");

  function salvarRascunho(){ localStorage.setItem("atividadesInstrumentacao", atividadesDiv.innerHTML); }

  function configurarOutroInstrumento(atividade){
    const select = atividade.querySelector(".tipo-instrumento");
    const outroInput = atividade.querySelector(".outro-instrumento");
    select.addEventListener("change", () => {
      if(select.value==="OUTRO"){ outroInput.style.display="block"; outroInput.required=true; }
      else{ outroInput.style.display="none"; outroInput.required=false; outroInput.value=""; }
      salvarRascunho();
    });
  }

  function adicionarAtividade(){
    const template = document.getElementById("template-atividade");
    const clone = template.content.cloneNode(true);
    atividadesDiv.appendChild(clone);
    const novaAtividade = atividadesDiv.lastElementChild;
    configurarOutroInstrumento(novaAtividade);
    salvarRascunho();
    setTimeout(()=>{ 
      const input = novaAtividade.querySelector("input,textarea,select");
      if(input){input.scrollIntoView({behavior:'smooth',block:'center'}); input.focus();}
    },100);
  }

  function removerAtividade(btn){ if(confirm("TEM CERTEZA QUE DESEJA REMOVER ESTA ATIVIDADE?")){ btn.parentElement.parentElement.remove(); salvarRascunho(); } }
  function duplicarAtividade(btn){ const atividade=btn.parentElement.parentElement; const clone=atividade.cloneNode(true); atividadesDiv.appendChild(clone); configurarOutroInstrumento(atividadesDiv.lastElementChild); salvarRascunho(); }

  function compartilharWhatsApp(){
    const tecnico = document.getElementById("select-tecnico").value || "-";
    const atividades = Array.from(atividadesDiv.children);
    let total = atividades.length;
    let concluido = atividades.filter(a => a.querySelector("select").value==="CONCLU√çDO").length;
    let naoConcluido = atividades.filter(a => a.querySelector("select").value==="N√ÉO CONCLU√çDO").length;
    let andamento = atividades.filter(a => a.querySelector("select").value==="EM ANDAMENTO").length;

    const dataAtual = new Date();
    const dataFormat = dataAtual.toLocaleDateString('pt-BR');
    const horaFormat = dataAtual.toLocaleTimeString('pt-BR');

    let msg = `RELAT√ìRIO DE ATIVIDADES DE INSTRUMENTA√á√ÉO\n\nüìÖ DATA: ${dataFormat}\nüïê HORA: ${horaFormat}\nüë∑ T√âCNICO(OS) RESPONS√ÅVEL(EIS): ${tecnico}\n\nRESUMO:\nTOTAL: ${total}\nCONCLU√çDO: ${concluido}\nN√ÉO CONCLU√çDO: ${naoConcluido}\nEM ANDAMENTO: ${andamento}\n\n`;

    atividades.forEach((a, i)=>{
      const ordem = a.querySelector('input')?.value || "-";
      const instrumento = a.querySelector('.tipo-instrumento')?.value || "-";
      const descricao = a.querySelectorAll('textarea')[0]?.value || "-";
      const atividadesRealizadas = a.querySelectorAll('textarea')[1]?.value || "-";
      const status = a.querySelector('select')?.value || "SELECIONE";
      msg += `üìë ATIVIDADE ${i+1}:\n üìà ORDEM: ${ordem}\n üîß INSTRUMENTO: ${instrumento}\n üìù DESCRI√á√ÉO: ${descricao}\n ‚öô ATIVIDADES: ${atividadesRealizadas}\n üìç STATUS FINAL: ${status}\n\n`;
    });

    const url = `https://api.whatsapp.com/send?text=${encodeURIComponent(msg)}`;
    window.open(url, '_blank');
  }

  adicionarAtividade();

  window.adicionarAtividade = adicionarAtividade;
  window.removerAtividade = removerAtividade;
  window.duplicarAtividade = duplicarAtividade;
  window.compartilharWhatsApp = compartilharWhatsApp;
});
</script>
</body>
</html>
